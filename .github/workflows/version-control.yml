name: Changeset Version Check Only

on:
  pull_request:
    branches: [develop]
    types: [opened, synchronize, reopened]

concurrency: ${{ github.workflow }}-${{ github.ref }}

jobs:
  check-and-preview-changesets:
    name: Check & Preview Changesets
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request' && github.base_ref == 'develop'

    steps:
      - name: π“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: π“¦ Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 9.12.0

      - name: β™οΈ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'pnpm'

      - name: π“ Install dependencies
        run: pnpm install --frozen-lockfile

      - name: β… Check for Changesets
        run: |
          echo "π” Changeset μ΅΄μ¬ μ—¬λ¶€ ν™•μΈ μ¤‘..."
          
          if [ ! -d ".changeset" ]; then
            echo "β .changeset λ””λ ‰ν† λ¦¬κ°€ μ—†μµλ‹λ‹¤!"
            echo "π’΅ 'pnpm changeset'μ„ μ‹¤ν–‰ν•μ—¬ λ³€κ²½μ‚¬ν•­μ„ μ‘μ„±ν•΄μ£Όμ„Έμ”."
            exit 1
          fi
          
          if [ -z "$(ls -A .changeset/*.md 2>/dev/null)" ]; then
            echo "β .changeset λ””λ ‰ν† λ¦¬μ— changeset νμΌμ΄ μ—†μµλ‹λ‹¤!"
            echo "π’΅ 'pnpm changeset'μ„ μ‹¤ν–‰ν•μ—¬ λ³€κ²½μ‚¬ν•­μ„ μ‘μ„±ν•΄μ£Όμ„Έμ”."
            echo "π“– μμ„Έν• λ‚΄μ©μ€ CHANGESETS.mdλ¥Ό μ°Έκ³ ν•μ„Έμ”."
            exit 1
          fi
          
          echo "β… λ‹¤μ changeset νμΌλ“¤μ΄ ν™•μΈλμ—μµλ‹λ‹¤:"
          ls -la .changeset/*.md
          echo ""

      - name: π” Changeset λ²„μ „ λ³€κ²½ λ―Έλ¦¬λ³΄κΈ°
        run: |
          echo "π“¦ λ³€κ²½λ  λ²„μ „ λ―Έλ¦¬λ³΄κΈ°:"
          echo "================================"
          changeset status || echo "β οΈ Changeset μƒνƒλ¥Ό ν™•μΈν•  μ μ—†μµλ‹λ‹¤."
          echo ""
          echo "π“– μμ„Έν• λ²„μ „ μ—…λ°μ΄νΈ λ‚΄μ—­μ€ μ„ λ‚΄μ©μ„ μ°Έμ΅°ν•΄μ£Όμ„Έμ”."